name: Sync to Notion

on:
  issues:
    types: [opened, edited, closed]
  pull_request:
    types: [opened, edited, closed]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Sync GitHub to Notion
        run: |
          python3 << 'EOF'
          import requests
          import json
          
          NOTION_TOKEN = "${{ secrets.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 }}"
          NOTION_DB_ID = "${{ secrets.2df41cdce3048026ae26dc8a59af1678?v=2ed41cdce30480a1a6ff000ce3d673e3 }}"
          
          # GitHub 이벤트 정보
          title = "${{ github.event.issue.title }}"
          url = "${{ github.event.issue.html_url }}"
          status = "${{ github.event.action }}"
          
          # Notion에 추가
          headers = {
              "Authorization": f"Bearer {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}",
              "Content-Type": "application/json",
              "Notion-Version": "2022-06-28"
          }
          
          data = {
              "parent": {"database_id": 2df41cdce3048026ae26dc8a59af1678?v=2ed41cdce30480a1a6ff000ce3d673e3},
              "properties": {
                  "Title": {
                      "title": [{"text": {"content": title}}]
                  },
                  "GitHub URL": {
                      "url": url
                  },
                  "Status": {
                      "select": {"name": "Open"}
                  }
              }
          }
          
          response = requests.post(
              "https://api.notion.com/v1/pages",
              headers=headers,
              json=data
          )
          print(response.status_code)
          EOF
