# v11-18-14:15 패치 노트

## 주요 변경사항

### 1. 에테르-배율 간격 롤백 🔄
**변경**: 에테르 획득량과 배율 표시 사이의 간격을 이전 버전으로 복원했습니다.

#### 세부사항:
- 이전 (v11-18-14:09): flexbox로 분리, `gap: '4px'`
- 현재: 인라인 표시로 복원 (공백 하나)
- 다른 간격(콤보 이름 ↔ 에테르)은 2px로 유지

#### 코드 변경:
```jsx
// 이전
<div style={{display: 'flex', gap: '4px'}}>
  <span>+15 PT</span>
  <span>(×0.50)</span>
</div>

// 현재
<div>
  +15 PT {pendingComboEther.multiplier < 1 && (
    <span>(×0.50)</span>
  )}
</div>
```

#### 효과:
- 자연스러운 간격 복원
- 에테르와 배율이 하나의 정보 단위로 더 응집됨
- 기존 사용자 경험 유지

### 2. 적 타임라인 애니메이션 작동 수정 ✅
**수정**: 적의 타임라인 액션에서 애니메이션이 작동하지 않던 문제를 해결했습니다.

#### 문제 원인:
- `stepOnce` 함수에서 `a.actor === 'player'`일 때만 `usedCardIndices` 설정
- 적의 액션은 타임라인 애니메이션 상태에 포함되지 않음

#### 해결 방법:
```javascript
// 이전: 플레이어만 애니메이션
if(a.actor === 'player') {
  setUsedCardIndices(prev => [...prev, qIndex]);
}

// 현재: 모든 액션에 타임라인 애니메이션 적용
setUsedCardIndices(prev => [...prev, qIndex]);
setTimeout(() => {
  setUsedCardIndices(prev => prev.filter(i => i !== qIndex));
}, 600);

// 카드 소멸은 플레이어만
if(a.actor === 'player') {
  // 손패에서 사라지는 애니메이션
}
```

#### 효과:
- 적의 액션도 타임라인에서 애니메이션 효과 표시
- 플레이어와 적 모두 실시간 진행 상황 파악 가능
- 카드 소멸은 여전히 플레이어만 적용

### 3. 적 타임라인 애니메이션 구분 강화 🟣
**변경**: 적의 타임라인 애니메이션을 보라색으로 변경하여 플레이어와 명확하게 구분됩니다.

#### 색상 변경:
- **이전**: 빨간색 (`rgba(239, 68, 68)`)
  - 문제: 적 마커의 기본 배경색(오렌지/빨강)과 구분 어려움
- **현재**: 보라색 (`rgba(168, 85, 247)`) - Purple-500
  - 적의 오렌지 배경과 명확하게 구분됨

#### 추가 개선:
- **테두리 추가**: 애니메이션 중 색상별 테두리 표시
  - 플레이어: 황금색 테두리 (`border: 2px solid rgba(251, 191, 36)`)
  - 적: 보라색 테두리 (`border: 2px solid rgba(168, 85, 247)`)
- **발광 강화**: box-shadow 크기 증가 (30px → 35px, 40px → 45px)

#### 시각적 비교:
| 속성 | 플레이어 | 적 |
|------|----------|-----|
| 발광 색상 | 황금색 (#fbbf24) | 보라색 (#a855f7) |
| 테두리 색상 | 황금색 | 보라색 |
| 발광 크기 | 30-40px | 35-45px |
| 기본 배경 | 파란색 계열 | 오렌지 계열 |

#### 효과:
```
플레이어 턴: 파란색 마커 → 황금색 펄스 + 테두리
     VS
적 턴: 오렌지 마커 → 보라색 펄스 + 테두리
```

- **즉각적인 구분**: 색상만으로 누구의 턴인지 즉시 파악
- **명확한 시각적 피드백**: 보라색 발광이 오렌지 배경 위에서 뚜렷하게 보임
- **일관된 경험**: 양측 모두 동일한 펄스 효과로 통일성 유지

---

## 파일 변경사항

### src/components/battle/LegacyBattleApp.jsx
- 에테르-배율 간격 롤백: flexbox 제거, 인라인으로 복원 (1270-1276줄)
- `stepOnce` 함수 수정: 모든 액션에 타임라인 애니메이션 적용 (1044-1060줄)
  - 타임라인 애니메이션: 플레이어 + 적 (600ms)
  - 카드 소멸 애니메이션: 플레이어만 (300ms 후 시작)

### src/components/battle/legacy-battle.css
- 플레이어 타임라인 애니메이션: 황금색 테두리 추가 (277-295줄)
- 적 타임라인 애니메이션: 보라색으로 변경 + 테두리 추가 (298-315줄)
  - 색상: 빨간색 → 보라색 (`rgba(168, 85, 247)`)
  - 테두리: 2px solid 보라색 추가
  - 발광 크기: 30-40px → 35-45px

### src/components/map/MapDemo.jsx
- 버전 태그: `11-18-14:09` → `11-18-14:15` (108줄)

---

## 버그 수정
🐛 적 타임라인 애니메이션 미작동 수정
🐛 적 타임라인 애니메이션 구분 불가 문제 해결

## 개선사항
🔄 에테르-배율 간격 사용자 경험 복원
🟣 보라색 발광으로 적 애니메이션 명확하게 구분
✨ 테두리 효과 추가로 양측 애니메이션 강조

## UX 개선
- **즉각적인 인식**: 색상(황금/보라)만으로 누구의 턴인지 파악
- **명확한 구분**: 보라색이 오렌지 배경 위에서 뚜렷하게 보임
- **일관된 경험**: 양측 모두 동일한 펄스 패턴
- **자연스러운 간격**: 에테르와 배율이 하나의 단위로 표시

---

## 기술적 세부사항

### stepOnce 함수 로직 변경

#### 이전:
```javascript
if(a.actor === 'player') {
  // 플레이어만 타임라인 + 카드 소멸 애니메이션
  setUsedCardIndices(prev => [...prev, qIndex]);
  setTimeout(() => {
    setUsedCardIndices(prev => prev.filter(i => i !== qIndex));
    setDisappearingCards(prev => [...prev, qIndex]);
    // ...
  }, 300);
}
```

#### 현재:
```javascript
// 모든 액션: 타임라인 애니메이션
setUsedCardIndices(prev => [...prev, qIndex]);
setTimeout(() => {
  setUsedCardIndices(prev => prev.filter(i => i !== qIndex));
}, 600);

// 플레이어만: 카드 소멸 애니메이션
if(a.actor === 'player') {
  setTimeout(() => {
    setDisappearingCards(prev => [...prev, qIndex]);
    // ...
  }, 300);
}
```

**변경 효과**:
- `usedCardIndices`가 플레이어/적 모두 포함
- 타임라인 렌더링에서 양측 애니메이션 모두 트리거
- 카드 소멸은 플레이어만 유지

---

## CSS 애니메이션 비교

### 플레이어 (황금색)
```css
.timeline-active.marker-player {
  box-shadow: 0 0 30px rgba(251, 191, 36, 1);
  border: 2px solid rgba(251, 191, 36, 0.8);
  transform: scale(1.2);
}

@keyframes timelinePulsePlayer {
  50% {
    box-shadow: 0 0 40px rgba(251, 191, 36, 1);
    border: 2px solid rgba(251, 191, 36, 1);
    transform: scale(1.35);
  }
}
```

### 적 (보라색)
```css
.timeline-active.marker-enemy {
  box-shadow: 0 0 35px rgba(168, 85, 247, 1);
  border: 2px solid rgba(168, 85, 247, 0.8);
  transform: scale(1.2);
}

@keyframes timelinePulseEnemy {
  50% {
    box-shadow: 0 0 45px rgba(168, 85, 247, 1);
    border: 2px solid rgba(168, 85, 247, 1);
    transform: scale(1.35);
  }
}
```

**차이점**:
- 발광 색상: 황금 vs 보라
- 테두리 색상: 황금 vs 보라
- 발광 크기: 적이 약간 더 큼 (35-45px vs 30-40px)

---

**패치 시간**: 2025-11-18 14:15 (KST)
**이전 버전**: v11-18-14:09

**주요 수정**: 적 타임라인 애니메이션 버그 수정 및 구분 강화
