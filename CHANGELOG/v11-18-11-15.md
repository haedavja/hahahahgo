# v11-18-11:15 - 전투 화면 렌더링 에러 및 클릭 문제 긴급 수정

## 긴급 버그 수정

### 1. startResolve 초기화 에러 수정 (Critical)
**에러**:
```
Uncaught ReferenceError: Cannot access 'startResolve' before initialization
    at Game (LegacyBattleApp.jsx:766:24)
```

**원인**: E키 단축키 useEffect에서 `startResolve` 함수를 의존성 배열에 추가했으나, 함수가 useEffect보다 나중에 선언됨

**해결**:
- E키 단축키를 DOM 클릭 방식으로 변경
- `document.querySelector('.submit-button-fixed button').click()` 사용
- 의존성 배열에서 `startResolve` 제거

**수정 파일**: `src/components/battle/LegacyBattleApp.jsx` (lines 760-764)

### 2. 손패 영역 클릭 간섭 문제 수정
**문제**: .hand-area가 다른 UI 요소의 클릭을 차단

**해결**:
- `.hand-area` z-index: 100 → 90으로 추가 하향
- `.hand-area`에 `pointer-events: none` 추가 (영역 자체는 클릭 불가)
- `.hand-cards`에 `pointer-events: auto` 추가 (카드는 클릭 가능)

**수정 파일**: `src/components/battle/legacy-battle.css`

## 버전 태그 수정
- **이전**: 11-18-09:40 (잘못된 시간)
- **현재**: 11-18-11:15 (한국 시간 기준)
- **파일**: `src/components/map/MapDemo.jsx` (line 108)

## 기술적 세부사항

### CSS 변경사항
```css
/* .hand-area - 손패 영역 */
.hand-area {
  z-index: 90; /* 100 → 90 */
  pointer-events: none; /* 영역 자체는 클릭 불가 */
}

/* .hand-cards - 카드 컨테이너 */
.hand-cards {
  pointer-events: auto; /* 카드는 클릭 가능 */
}
```

### JSX 변경사항
```javascript
// E키 단축키 - DOM 클릭 방식
if ((e.key === "e" || e.key === "E") && phase === 'select' && selected.length > 0) {
  const submitBtn = document.querySelector('.submit-button-fixed button');
  if (submitBtn && !submitBtn.disabled) submitBtn.click();
}
```

## 변경된 파일
1. `src/components/battle/LegacyBattleApp.jsx`
   - startResolve 초기화 에러 수정
   - E키 단축키를 DOM 클릭 방식으로 변경

2. `src/components/battle/legacy-battle.css`
   - .hand-area z-index 조정 및 pointer-events 추가
   - .hand-cards pointer-events 설정

3. `src/components/map/MapDemo.jsx`
   - 버전 태그: 11-18-09:40 → 11-18-11:15

## 테스트 가이드
1. **전투 화면 진입**
   - 맵에서 전투 노드 클릭
   - 화면이 정상적으로 렌더링되는지 확인
   - 콘솔에 에러가 없는지 확인

2. **버튼 클릭**
   - 카드 선택 가능 여부 확인
   - 제출 버튼 클릭 가능 여부 확인
   - 간소화 버튼 클릭 가능 여부 확인

3. **E키 단축키**
   - 카드 선택 후 E키로 제출되는지 확인

## 우선순위
- **Priority**: Critical (게임 진행 불가 에러)
- **Status**: Fixed
- **Test**: Required

## 다음 작업
- 사용자 테스트 후 추가 문제 확인
- 필요시 z-index 레이어 재조정
