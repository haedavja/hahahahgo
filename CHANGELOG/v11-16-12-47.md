# v11-16-12:47 - 예상 피해량 미리보기 UI 개선, VS 패널 로그 제거

**날짜**: 2025-11-16 12:47 (KST)
**커밋**: (커밋 예정)

## 변경 사항

### 1. 예상 피해량 미리보기에 타이틀 및 단계 라벨 추가

**파일**: `src/components/battle/LegacyBattleApp.jsx` (401-420줄)

#### 추가된 요소

```jsx
{/* 타이틀 및 단계 라벨 */}
<div style={{marginBottom: '16px', paddingBottom: '12px', borderBottom: '2px solid rgba(148, 163, 184, 0.3)'}}>
  <div style={{fontSize: '18px', fontWeight: 'bold', color: '#f8fafc', marginBottom: '4px'}}>
    예상 피해량
  </div>
  <div style={{fontSize: '13px', color: '#94a3b8'}}>
    {phaseLabel}
  </div>
</div>
```

**주요 내용**:
- **타이틀**: "예상 피해량" (18px, bold, 밝은 흰색)
- **단계 라벨**: 현재 전투 단계 표시
  - '선택 단계' (phase === 'select')
  - '대응 단계' (phase === 'respond')
  - '진행 단계' (phase === 'resolve')
- **시각적 구분**: 2px 테두리로 헤더 영역 구분

### 2. VS 패널 중앙 로그 제거

**파일**: `src/components/battle/LegacyBattleApp.jsx` (1057-1059줄)

#### 변경 전
```jsx
<div className="vs-panel">
  <div className="vs-icon">⚔️</div>
  <div className="vs-status">
    {phase==='respond' ? "대응 단계" : phase==='resolve' ? `진행 중 (${qIndex}/${queue?.length || 0})` : "선택 단계"}
  </div>
  <div className="vs-log">
    {log.slice(-6).map((l,i)=>(<div key={i}>{l}</div>))}
  </div>
</div>
```

#### 변경 후
```jsx
<div className="vs-panel">
  <div className="vs-icon">⚔️</div>
  <div className="vs-status">
    {phase==='respond' ? "대응 단계" : phase==='resolve' ? `진행 중 (${qIndex}/${queue?.length || 0})` : "선택 단계"}
  </div>
</div>
```

**주요 내용**:
- **vs-log 섹션 제거**: 화면 중앙의 로그 표시 완전 제거
- **화면 깔끔하게**: VS 패널이 아이콘과 상태만 표시하도록 간소화

### 3. 진행 단계 전투 로그를 미리보기 패널에 통합

**파일**: `src/components/battle/LegacyBattleApp.jsx`

#### ExpectedDamagePreview 컴포넌트 개선 (401줄, 464-482줄)

```jsx
function ExpectedDamagePreview({player, enemy, fixedOrder, willOverdrive, enemyMode, enemyActions, phase, log}){
  // ... 기존 코드 ...

  {/* 진행 단계 전투 로그 */}
  {phase === 'resolve' && log && log.length > 0 && (
    <div style={{marginTop: '20px', paddingTop: '16px', borderTop: '2px solid rgba(148, 163, 184, 0.3)'}}>
      <div style={{fontSize: '15px', fontWeight: 'bold', color: '#f8fafc', marginBottom: '12px'}}>
        🎮 전투 로그
      </div>
      <div style={{maxHeight: '300px', overflowY: 'auto'}}>
        {log.map((line, i) => (
          <div key={i} style={{
            fontSize: '13px',
            color: '#cbd5e1',
            marginBottom: '6px',
            lineHeight: '1.5'
          }}>
            {line}
          </div>
        ))}
      </div>
    </div>
  )}
}
```

**주요 내용**:
- **log prop 추가**: ExpectedDamagePreview가 전투 로그를 받을 수 있도록 수정
- **조건부 렌더링**: 진행 단계(phase === 'resolve')에서만 전투 로그 표시
- **로그 섹션 스타일**:
  - 타이틀: "🎮 전투 로그" (15px, bold)
  - 최대 높이: 300px (스크롤 가능)
  - 로그 라인: 13px, 회색 (#cbd5e1)
- **시각적 구분**: 2px 테두리로 로그 섹션 구분

#### 미리보기 패널 표시 조건 변경 (963-974줄)

**변경 전**:
```jsx
{(phase==='respond' || phase==='select') && (
  <div className="expect-sidebar-fixed">
    <ExpectedDamagePreview ... />
  </div>
)}
```

**변경 후**:
```jsx
<div className="expect-sidebar-fixed">
  <ExpectedDamagePreview
    player={player}
    enemy={enemy}
    fixedOrder={fixedOrder||playerTimeline}
    willOverdrive={willOverdrive}
    enemyMode={enemyPlan.mode}
    enemyActions={enemyPlan.actions}
    phase={phase}
    log={log}
  />
</div>
```

**주요 내용**:
- **항상 표시**: 모든 단계(select, respond, resolve)에서 미리보기 패널 표시
- **log prop 전달**: 전투 로그를 컴포넌트에 전달

### 4. 버전 태그 및 패치 노트 업데이트

**파일**: `src/components/map/MapDemo.jsx` (105-112줄)

```jsx
const PATCH_VERSION_TAG = "11-16-12:47"; // 다음 패치마다 여기를 최신 시간(월-일-시:분, KST)으로 갱신하세요.

/* v11-16-12:47 갱신 내역
 * - 예상 피해량 미리보기: '예상 피해량' 타이틀 및 단계 라벨 추가 (선택/대응/진행 단계 표시)
 * - VS 패널 중앙 로그 제거: 화면 중앙 로그 표시 제거로 전투 화면 깔끔하게 개선
 * - 전투 로그 통합: 진행 단계에서 전투 로그가 예상 피해량 패널 내부에 표시되도록 UI 재배치
 * - 미리보기 패널이 모든 단계에서 표시되어 일관된 UX 제공
 */
```

## 기술 세부사항

### UI 레이아웃 변경

**이전**:
```
┌─────────────┐                        ┌─────────────┐
│  플레이어   │       ⚔️ VS           │   몬스터    │
│             │   [전투 로그 6줄]      │             │
└─────────────┘                        └─────────────┘

                [선택/대응 단계에만 예상 피해량 패널]
```

**변경 후**:
```
┌─────────────┐                        ┌─────────────┐
│  플레이어   │       ⚔️ VS           │   몬스터    │
│             │   (상태만 표시)        │             │
└─────────────┘                        └─────────────┘

┌────────────────────────┐
│  예상 피해량            │ ← 타이틀
│  선택 단계              │ ← 단계 라벨
├────────────────────────┤
│  🗡️ 플레이어 가한 피해 │
│  💥 플레이어 피격 피해  │
│  HP 정보                │
├────────────────────────┤
│  🎮 전투 로그           │ ← 진행 단계에만 표시
│  (로그 내용...)         │
└────────────────────────┘
   모든 단계에서 표시
```

### 전투 로그 이동 경로

**이전**:
- VS 패널 중앙 (항상 표시)
- 최대 6줄만 표시 (`log.slice(-6)`)

**변경 후**:
- 예상 피해량 패널 내부 (진행 단계에만 표시)
- 모든 로그 표시 (스크롤 가능, 최대 높이 300px)

### 단계별 미리보기 패널 표시

| 단계 | 타이틀 | 단계 라벨 | 피해 정보 | 전투 로그 |
|------|--------|-----------|-----------|-----------|
| 선택 | ✓ | 선택 단계 | ✓ (피격 '?') | ✗ |
| 대응 | ✓ | 대응 단계 | ✓ | ✗ |
| 진행 | ✓ | 진행 단계 | ✓ | ✓ |

## UI 개선 효과

### 장점

1. **정보 구조 개선**
   - 예상 피해량 패널에 명확한 타이틀과 단계 정보 표시
   - 사용자가 현재 어떤 단계인지 쉽게 파악 가능

2. **화면 깔끔하게**
   - VS 패널 중앙의 로그 제거로 전투 화면이 더 깔끔함
   - 플레이어와 몬스터 사이의 시각적 혼란 감소

3. **로그 가독성 향상**
   - 진행 단계에서 전투 로그가 오른쪽 패널에 통합
   - 스크롤 가능한 영역으로 모든 로그 확인 가능 (이전 6줄 제한 제거)
   - 최대 높이 300px로 적절한 공간 확보

4. **일관된 UX**
   - 모든 단계에서 예상 피해량 패널 표시
   - 진행 단계에서도 HP 정보를 계속 볼 수 있음
   - 단계 전환 시 패널이 사라지지 않아 시각적 안정성 증가

### 사용자 경험

- **단계 인식**: 타이틀과 라벨로 현재 단계를 명확히 인식
- **전투 추적**: 진행 단계에서 전투 로그를 실시간으로 확인
- **정보 접근**: 모든 정보가 오른쪽 패널에 집중되어 시선 이동 감소
- **화면 집중**: 중앙 화면이 깔끔해져서 전투 애니메이션에 집중 가능

## 이전 버전과의 차이

**이전 버전 (v11-16-11:12)**:
- VS 패널에 전투 로그 표시 (6줄)
- 예상 피해량 패널: 선택/대응 단계에만 표시
- 미리보기에 타이틀/단계 라벨 없음

**현재 버전**:
- VS 패널: 아이콘과 상태만 표시
- 예상 피해량 패널: 모든 단계에서 표시
- 타이틀 "예상 피해량" 및 단계 라벨 추가
- 진행 단계에서 전투 로그가 미리보기 내부에 표시

## 다음 AI를 위한 참고사항

1. **로그 표시 조건**:
   - 현재 `phase === 'resolve'`에서만 전투 로그 표시
   - 다른 단계에서도 표시하려면 조건 수정 필요

2. **로그 최대 높이**:
   - 현재 300px로 설정
   - 더 많은/적은 로그를 보려면 maxHeight 조정
   - 또는 maxHeight 제거하여 무제한 표시 가능

3. **단계 라벨 커스터마이징**:
   - `phaseLabel` 변수에서 라벨 텍스트 변경 가능
   - 이모지 추가: '⚔️ 선택 단계' 등
   - 영어 버전: 'Select Phase' 등

4. **VS 패널 로그 복원**:
   - 필요시 `.vs-log` div를 다시 추가
   - `{log.slice(-6).map((l,i)=>(<div key={i}>{l}</div>))}`

5. **미리보기 패널 조건부 표시**:
   - 현재 모든 단계에서 표시
   - 특정 단계에만 표시하려면 조건 추가:
     ```jsx
     {(phase === 'select' || phase === 'respond') && (
       <div className="expect-sidebar-fixed">...</div>
     )}
     ```

6. **타이틀 스타일 변경**:
   - fontSize: 18px → 원하는 크기로 조정
   - color: #f8fafc → 원하는 색상으로 변경
   - 이모지 추가: "⚡ 예상 피해량"

## 변경 파일 목록

- `src/components/battle/LegacyBattleApp.jsx`
  - ExpectedDamagePreview 컴포넌트: log prop 추가, 타이틀/라벨 추가, 전투 로그 섹션 추가 (401-485줄)
  - VS 패널: vs-log 제거 (1052-1057줄)
  - 미리보기 패널: 조건 제거, log prop 전달 (963-974줄)
- `src/components/map/MapDemo.jsx`
  - PATCH_VERSION_TAG 업데이트: 11-16-11:12 → 11-16-12:47 (105줄)
  - 패치 노트 갱신 (107-112줄)
- `CHANGELOG/v11-16-12-47.md`
  - 새 버전 문서 생성
