# v11-16-09:13 - 타임라인 롤백 및 대응 단계 손패 유지

**날짜**: 2025-11-16 09:13 (KST)
**커밋**: dae6287

## 변경 사항

### 1. 타임라인을 이전 형태로 롤백 (가로축 누적 속도는 유지)

**파일**: `src/components/battle/legacy-battle.css`
- **timeline-lanes**: `flex-direction: column` (레인들이 세로로 배치)
- **timeline-lane**: `height: 80px` (고정 높이 복원)
- **gridline**: 세로선으로 복원 (top/bottom, width)
- **marker**: `transform: translate(-50%, 0)` (가로 위치)
- **timeline-axis**: `flex-direction: row` 유지 (속도 눈금이 가로로)

**파일**: `src/components/battle/LegacyBattleApp.jsx`
- gridline 위치: `top` → `left` (943, 963줄)
- marker 위치: `left` ↔ `top` 교체 (953, 973줄)

### 2. 손패가 대응 단계에서도 유지

**파일**: `src/components/battle/LegacyBattleApp.jsx`
- 손패 영역 표시 조건 변경 (1195줄)
  - 기존: `phase==='select' || ...`
  - 변경: `phase==='select' || phase==='respond' || ...`

### 3. 대응 단계에서 손패 카드 순서 변경 가능

**파일**: `src/components/battle/LegacyBattleApp.jsx` (1286-1336줄)
- fixedOrder에서 player 액션만 필터링하여 표시
- 각 카드에 ↑↓ 버튼 추가
- 버튼 클릭 시:
  1. playerActions 배열에서 카드 순서 변경
  2. `sortCombinedOrderStablePF`로 새로운 fixedOrder 생성
  3. setFixedOrder 호출

## 기술 세부사항

### 타임라인 구조
```
timeline-body (flex column)
├─ timeline-axis (flex row) - 속도 눈금 가로 배치
└─ timeline-lanes (flex column)
   ├─ player-lane (height: 80px) - 플레이어 레인
   └─ enemy-lane (height: 80px) - 적 레인
```

### 대응 단계 손패 순서 변경 로직
```javascript
// 위로 이동
const newPlayerActions = [...playerActions];
[newPlayerActions[idx-1], newPlayerActions[idx]] =
  [newPlayerActions[idx], newPlayerActions[idx-1]];
setFixedOrder(sortCombinedOrderStablePF(
  newPlayerActions.map(a=>a.card),
  enemyActions.map(a=>a.card)
));
```

## 이전 버전과의 차이

**이전 버전 (v11-16-09:02)**:
- 타임라인 레인이 가로로 배치
- 손패가 선택 단계에서만 표시
- 대응 단계에서 카드 순서 변경 불가

**현재 버전**:
- 타임라인 레인이 세로로 배치 (가로축 속도 유지)
- 손패가 선택/대응 단계 모두에서 표시
- 대응 단계에서 ↑↓ 버튼으로 카드 순서 변경 가능

## 다음 AI를 위한 참고사항

1. **타임라인 구조**: 가로축은 속도(0-10), 세로축은 플레이어/적 레인
2. **fixedOrder**: 대응 단계에서 플레이어와 적의 액션이 속도 순으로 정렬된 배열
3. **sortCombinedOrderStablePF**: 플레이어 우선 정렬 함수 (동률 시 플레이어 먼저)
4. **hand-area**: position: fixed로 화면 하단에 고정
