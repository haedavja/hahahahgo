# v11-16-09:52 - 예상 피해량 창 오른쪽 고정 패널, 화면 하단까지 확장

**날짜**: 2025-11-16 09:52 (KST)
**커밋**: (커밋 예정)

## 변경 사항

### 1. 예상 피해량 창을 오른쪽 고정 패널로 변경

**파일**: `src/components/battle/LegacyBattleApp.jsx` (920-934줄)

#### 변경 전
- 타임라인과 같은 flex container 안에 배치
- width: 300px, flexShrink: 0
- 타임라인 옆에 세로 배치
- 높이가 타임라인에 맞춰짐

#### 변경 후
- position: fixed로 화면 오른쪽에 고정
- top: 0, bottom: 0, right: 0
- width: 320px
- 화면 전체 높이 사용, 스크롤 가능
- 별도 패널처럼 독립적으로 배치

### 2. 메인 영역 마진 조정

**파일**: `src/components/battle/LegacyBattleApp.jsx` (937줄)

```jsx
<div className="w-full px-4" style={{marginRight: (phase==='respond' || phase==='select') ? '340px' : '0'}}>
```

- 예상 피해량 창이 표시될 때 메인 영역의 오른쪽 마진 340px 추가
- 예상 피해량 창과 겹치지 않도록 공간 확보
- select/respond 단계가 아닐 때는 마진 0

### 3. 타임라인 레이아웃 단순화

**파일**: `src/components/battle/LegacyBattleApp.jsx` (940줄)

#### 변경 전
```jsx
<div style={{display: 'flex', gap: '24px', alignItems: 'flex-start', marginBottom: '24px'}}>
  <div className="panel-enhanced timeline-panel" style={{flex: 1}}>
    {/* Timeline */}
  </div>
  <div style={{width: '300px', flexShrink: 0}}>
    {/* 예상 피해량 */}
  </div>
</div>
```

#### 변경 후
```jsx
<div style={{marginBottom: '24px'}}>
  <div className="panel-enhanced timeline-panel">
    {/* Timeline */}
  </div>
</div>
```

- flex container 제거
- 타임라인만 남음
- 단순한 블록 레이아웃

### 4. CSS 스타일 추가 및 수정

**파일**: `src/components/battle/legacy-battle.css`

#### expect-sidebar-fixed (278-303줄)
```css
.expect-sidebar-fixed {
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: 320px;
  overflow-y: auto;
  z-index: 50;
  padding: 20px 16px;
  background: rgba(7, 11, 30, 0.95);
  border-left: 1px solid rgba(148, 163, 184, 0.3);
  box-shadow: -10px 0 40px rgba(0, 0, 0, 0.5);
}

.expect-sidebar-fixed::-webkit-scrollbar {
  width: 8px;
}

.expect-sidebar-fixed::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.3);
  border-radius: 999px;
}

.expect-sidebar-fixed::-webkit-scrollbar-track {
  background: rgba(15, 23, 42, 0.4);
}
```

#### expect-board-vertical 수정 (315-321줄)
```css
.expect-board-vertical {
  padding: 0;
  font-size: 0.9rem;
  background: transparent;  /* 추가 */
  border: none;             /* 추가 */
  box-shadow: none;         /* 추가 */
}
```

- 고정 패널 내부이므로 배경/테두리 제거
- 부모 패널의 스타일 사용

#### expect-log-vertical 수정 (374-378줄)
```css
.expect-log-vertical {
  border-bottom: 1px solid rgba(148, 163, 184, 0.15);
  padding-bottom: 12px;
  margin-bottom: 12px;
  /* max-height: 300px 제거 */
  /* overflow-y: auto 제거 */
}
```

- max-height 제한 제거
- 부모 컨테이너(expect-sidebar-fixed)가 스크롤 관리

## 기술 세부사항

### 레이아웃 구조

**이전**:
```
┌──────────────────────────┬──────────┐
│  Timeline (flex: 1)      │ 예상     │
│                          │ 피해량   │
│                          │ (300px)  │
└──────────────────────────┴──────────┘
```

**변경 후**:
```
┌───────────────────────────┐┃예┃
│  Timeline (전체 너비)     │┃상┃
│  (marginRight: 340px)     │┃피┃
│                           │┃해┃
│                           │┃량┃
│                           │┃  ┃
│                           │┃창┃
│                           │┃  ┃
│                           │┃(┃
│                           │┃3┃
│                           │┃2┃
│                           │┃0┃
│                           │┃p┃
│                           │┃x┃
│                           │┃)┃
│                           │┃  ┃
│                           │┃f┃
│                           │┃i┃
│                           │┃x┃
│                           │┃e┃
│                           │┃d┃
└───────────────────────────┘┃  ┃
(손패 영역, fixed bottom)    ┃↓┃
                            ┃스┃
                            ┃크┃
                            ┃롤┃
```

### z-index 계층

- **손패 영역**: z-index: 100 (최상위)
- **예상 피해량 창**: z-index: 50 (중간)
- **타임라인/전투 영역**: z-index: auto (기본)

### 스크롤 동작

- **예상 피해량 창**:
  - 전체 패널이 overflow-y: auto
  - 내용이 화면 높이를 초과하면 스크롤
  - 커스텀 스크롤바 스타일 적용

- **로그 영역**:
  - max-height 제한 제거
  - 부모 패널의 스크롤 사용
  - 로그가 많아도 모두 표시 가능

## UI 개선 효과

### 장점

1. **화면 하단까지 확장**
   - 예상 피해량 창이 화면 전체 높이 사용
   - 로그가 많아도 모두 표시 가능
   - 스크롤로 모든 정보 확인 가능

2. **별도 패널처럼 독립적**
   - position: fixed로 화면 오른쪽에 고정
   - 스크롤해도 항상 같은 위치
   - 타임라인과 독립적으로 동작

3. **공간 활용 최적화**
   - 타임라인이 더 넓어짐 (340px 여백 고려해도)
   - 예상 피해량 창이 화면 전체 높이 활용
   - 정보 밀도 증가

4. **시각적 구분**
   - 왼쪽 그림자로 분리감 강조
   - 진한 배경색으로 가독성 향상
   - 왼쪽 테두리로 경계 명확

### 고려사항

- **작은 화면**: 320px + 340px margin = 660px 필요
- **손패와의 관계**: 손패가 z-index: 100으로 예상 피해량 창 위에 표시
- **반응형**: 작은 화면에서는 조정 필요할 수 있음

## 이전 버전과의 차이

**이전 버전 (v11-16-09:47)**:
- 타임라인과 예상 피해량 창이 flex로 좌우 배치
- 예상 피해량 창 높이가 타임라인에 맞춰짐
- 로그에 max-height: 300px 제한

**현재 버전**:
- 예상 피해량 창이 position: fixed로 독립
- 화면 전체 높이 사용 (top: 0, bottom: 0)
- 로그 제한 없이 모두 표시 가능

## 다음 AI를 위한 참고사항

1. **position: fixed**:
   - 화면 기준 고정 위치
   - 스크롤해도 위치 변하지 않음
   - right: 0으로 오른쪽 끝에 고정

2. **z-index 관리**:
   - 손패 (100) > 예상 피해량 (50) > 기본
   - 손패가 예상 피해량 위에 표시됨
   - 필요시 조정 가능

3. **조건부 마진**:
   ```jsx
   marginRight: (phase==='respond' || phase==='select') ? '340px' : '0'
   ```
   - select/respond 단계에만 마진 적용
   - 다른 단계에서는 전체 너비 사용

4. **스크롤바 커스터마이징**:
   - ::-webkit-scrollbar 사용
   - Firefox는 별도 스타일 필요할 수 있음

5. **반응형 대응**:
   - 작은 화면에서는 예상 피해량 창 숨기거나
   - 모달/오버레이 형태로 변경 고려

## 변경 파일 목록

- `src/components/battle/LegacyBattleApp.jsx`
  - 예상 피해량 창을 루트 레벨로 이동 (922-934줄)
  - 메인 영역에 조건부 마진 추가 (937줄)
  - 타임라인 레이아웃 단순화 (940줄)
  - 기존 예상 피해량 창 제거 (1000-1013줄 삭제)
- `src/components/battle/legacy-battle.css`
  - expect-sidebar-fixed 스타일 추가 (278-303줄)
  - expect-board-vertical 배경/테두리 제거 (315-321줄)
  - expect-log-vertical max-height 제거 (374-378줄)
- `src/components/map/MapDemo.jsx`
  - 버전 태그 업데이트
- `CHANGELOG/v11-16-09-52.md`
  - 새 버전 문서 생성
