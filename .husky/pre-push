#!/bin/sh

echo "ğŸ” Pre-push checks..."

# ë³€ê²½ëœ íŒŒì¼ì˜ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰ (ì†ë„ ìµœì í™”)
# --changed: ì§ì ‘ ë³€ê²½ëœ íŒŒì¼ë§Œ í…ŒìŠ¤íŠ¸ (ê°„ì ‘ ì˜í–¥ì€ CIì—ì„œ ê²€ì¦)
# --bail 1: ì²« ì‹¤íŒ¨ì—ì„œ ì¤‘ë‹¨
echo "ğŸ“‹ Running changed tests..."
npx vitest --changed HEAD~1 --run --bail 1
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Push aborted."
  exit 1
fi

# ë¹Œë“œ ê²€ì¦
echo "ğŸ—ï¸ Verifying build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Push aborted."
  exit 1
fi

# ë²ˆë“¤ í¬ê¸° ê²€ì‚¬
echo "ğŸ“¦ Checking bundle size..."
npm run check:bundle
if [ $? -ne 0 ]; then
  echo "âŒ Bundle size budget exceeded. Push aborted."
  exit 1
fi

echo "âœ… All pre-push checks passed!"
