#!/bin/sh

echo "ğŸ” Pre-push checks..."

# ë³€ê²½ëœ íŒŒì¼ ê´€ë ¨ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰ (ì†ë„ ìµœì í™”)
echo "ğŸ“‹ Running related tests..."
CHANGED_FILES=$(git diff --name-only origin/$(git rev-parse --abbrev-ref HEAD)..HEAD 2>/dev/null | grep -E '\.(ts|tsx)$' | tr '\n' ' ')

if [ -n "$CHANGED_FILES" ]; then
  npx vitest related $CHANGED_FILES --run
  if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Push aborted."
    exit 1
  fi
else
  echo "â­ï¸ No TS/TSX files changed, skipping tests."
fi

# ë¹Œë“œ ê²€ì¦
echo "ğŸ—ï¸ Verifying build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Push aborted."
  exit 1
fi

# ë²ˆë“¤ í¬ê¸° ê²€ì‚¬
echo "ğŸ“¦ Checking bundle size..."
npm run check:bundle
if [ $? -ne 0 ]; then
  echo "âŒ Bundle size budget exceeded. Push aborted."
  exit 1
fi

echo "âœ… All pre-push checks passed!"
