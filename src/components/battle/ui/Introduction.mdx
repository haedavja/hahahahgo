{/* Battle 컴포넌트 소개 문서 */}
import { Meta } from '@storybook/blocks';

<Meta title="Battle/Introduction" />

# Battle 컴포넌트

턴제 전투 시스템의 UI 컴포넌트입니다.

## 핵심 컴포넌트

| 컴포넌트 | 설명 | 주요 기능 |
|----------|------|----------|
| **HandArea** | 손패 영역 | 카드 선택, 순서 조정 |
| **TimelineDisplay** | 타임라인 | 속도 기반 실행 순서 시각화 |

## 전투 흐름

```
[select] 카드 선택 → [respond] 대응 → [resolve] 타임라인 진행
```

### 1. 선택 단계 (select)
- 플레이어가 손패에서 카드를 선택
- HandArea에서 카드 토글

### 2. 대응 단계 (respond)
- 선택된 카드의 실행 순서 조정
- `moveUp`, `moveDown` 콜백으로 순서 변경

### 3. 진행 단계 (resolve)
- TimelineDisplay의 시곗바늘이 이동
- 카드가 속도 순서대로 실행

## HandArea Props

```typescript
interface HandAreaProps {
  // 필수
  battle: { phase: 'select' | 'respond' | 'resolve'; queue: Action[] };
  player: { hp: number; maxHp: number; strength: number; tokens: TokenState };
  enemy: { hp: number };
  selected: Card[];
  getSortedHand: () => Card[];
  toggle: (card: Card) => void;
  handDisabled: (card: Card) => boolean;

  // 콜백
  showCardTraitTooltip: (card: Card, element: Element | null) => void;
  hideCardTraitTooltip: () => void;
  formatSpeedText: (speed: number) => string;
  renderNameWithBadge: (card: Card, color: string) => ReactNode;

  // 선택적
  fixedOrder?: Action[];      // 대응 단계 고정 순서
  moveUp?: (idx: number) => void;
  moveDown?: (idx: number) => void;
  queue?: Action[];           // 진행 단계 큐
  isSimplified?: boolean;     // 간략 모드
}
```

## TimelineDisplay Props

```typescript
interface TimelineDisplayProps {
  // 필수
  player: { maxSpeed: number; strength: number; tokens: TokenState };
  enemy: { maxSpeed: number; name: string };
  battle: { phase: string; selected: Card[] };

  // 타임라인 상태
  timelineProgress: number;           // 0-100%
  timelineIndicatorVisible: boolean;  // 시곗바늘 표시
  playerTimeline: TimelineAction[];
  enemyTimeline: TimelineAction[];

  // 통찰 시스템
  insightAnimLevel: number;           // 애니메이션 레벨 (0-3)
  effectiveInsight: number | null;    // 유효 통찰 레벨
  insightReveal: InsightReveal | null;

  // 진행 단계
  queue: TimelineAction[] | null;
  executingCardIndex: number;
  usedCardIndices: number[];
}
```

## 통찰 레벨 시스템

| 레벨 | 이름 | 효과 |
|------|------|------|
| -3 | 망각 | 타임라인 확인 불가 |
| -2 | 미련 | 진행단계에서 적 카드 숨김 |
| -1 | 우둔 | 대응단계에서 적 카드 숨김 |
| 0 | 평온 | 선택단계에서 적 카드 3개 확인 |
| +1 | 예측 | 선택단계에서 적 카드 2개 확인 |
| +2 | 독심 | 선택단계에서 적 카드 모두 확인 |
| +3 | 혜안 | 적 카드 + 상세 정보 확인 |

## 사용 예시

```tsx
import { HandArea } from './components/battle/ui/HandArea';
import { TimelineDisplay } from './components/battle/ui/TimelineDisplay';

// 손패 영역
<HandArea
  battle={battleState}
  player={playerState}
  enemy={enemyState}
  selected={selectedCards}
  getSortedHand={() => hand}
  toggle={handleToggle}
  handDisabled={isCardDisabled}
  showCardTraitTooltip={showTooltip}
  hideCardTraitTooltip={hideTooltip}
  formatSpeedText={(s) => `${s}`}
  renderNameWithBadge={(card) => card.name}
/>

// 타임라인
<TimelineDisplay
  player={player}
  enemy={enemy}
  battle={battle}
  timelineProgress={progress}
  timelineIndicatorVisible={true}
  playerTimeline={playerActions}
  enemyTimeline={enemyActions}
  // ...
/>
```

## 관련 문서

- [HandArea](?path=/docs/battle-handarea--docs) - 손패 영역 상세
- [TimelineDisplay](?path=/docs/battle-timelinedisplay--docs) - 타임라인 상세
