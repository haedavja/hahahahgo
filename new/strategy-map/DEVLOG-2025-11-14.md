## 2025-11-14 개발 로그

### 오늘 한 작업
- `public/battle.html`을 실행작업물에서 복사해 새 Vite/React 프로젝트에 이식.
- `LegacyBattleScreen`을 iframe 기반으로 바꾸고 맵에서 전투 화면으로 들어가도록 상태(store) 수정.
- 전투 승리 시 `resolveBattle()`가 호출되도록 `postMessage` 루프 연결.

### 발생했던 문제 & 원인
1. **battle.html 문자열 깨짐**  
   - 한글이 깨진 상태로 저장된 배포본을 직접 수정하면서 문자열 중 일부가 망가져 Babel 파싱 오류가 발생함. (예: `const who` 라인이 깨짐)  
   - 해결: 다시 실행작업물 원본을 복사해 덮어쓰고, 필요한 추가 기능은 나중에 안전하게 적용하기로 함.

2. **전투 결과 모달 JSON 출력**  
   - `lastBattleResult.log`에 객체가 섞여 들어오면서 React가 “objects are not valid children” 오류를 냈음.  
   - 해결: `MapDemo`에 `formatBattleLogEntry` 헬퍼를 추가해 객체를 사람이 읽을 수 있는 문자열로 변환해 표시.

3. **전투-맵 에테르 공유/조합 표기 작업**  
   - 진행 중 복잡도가 커져 전투가 깨져서 중단. 최종적으로 battle.html을 원상복구하고 추후 단계에서 다시 적용하는 것으로 결정.

### 현재 상태
- `public/battle.html`은 실행작업물 원본과 동일. 전투는 iframe에서 정상 실행됨.
- 맵과 전투 전환, 전투 결과 모달 표시, 자원/노드 선택 등 이전 기능은 정상 유지.
- 추후 작업자는 battle.html 커스터마이징을 다시 시도하기 전에 백업을 따로 두고 단계별 테스트 필요.
